<!-- templates/admin_dashboard.html -->
{% extends 'base.html' %}
{% load static %}

{% block page_title %}Tableau de Bord Admin{% endblock %}

{% block content %}
<div class="admin-dashboard">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="header-content">
            <div class="header-icon">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <rect x="3" y="3" width="7" height="7" rx="1"/>
                    <rect x="14" y="3" width="7" height="7" rx="1"/>
                    <rect x="14" y="14" width="7" height="7" rx="1"/>
                    <rect x="3" y="14" width="7" height="7" rx="1"/>
                </svg>
            </div>
            <div class="header-text">
                <h1>Tableau de Bord Administrateur</h1>
                <p>Bienvenue, <strong>{{ user.username }}</strong> ‚Ä¢ {{ "now"|date:"l d F Y, H:i" }}</p>
            </div>
        </div>
        <div class="header-actions">
            <button class="refresh-btn" onclick="location.reload()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                </svg>
                Actualiser
            </button>
            <a href="/admin/" class="admin-link-btn">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"/>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Django Admin
            </a>
            <div class="export-dropdown">
                <button class="export-btn" onclick="toggleExportMenu()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                        <polyline points="7 10 12 15 17 10"/>
                        <line x1="12" y1="15" x2="12" y2="3"/>
                    </svg>
                    Exporter
                </button>
                <div class="export-menu" id="exportMenu">
                    <a href="/api/admin/export/?type=sessions&period=week">Sessions (semaine)</a>
                    <a href="/api/admin/export/?type=searches&period=week">Recherches (semaine)</a>
                    <a href="/api/admin/export/?type=likes&period=week">Likes (semaine)</a>
                    <a href="/api/admin/export/?type=sessions&period=month">Sessions (mois)</a>
                </div>
            </div>
        </div>
    </header>

    <!-- Real-Time Section -->
    <section class="realtime-section">
        <div class="realtime-card">
            <div class="realtime-indicator">
                <span class="pulse-dot"></span>
                <span>EN DIRECT</span>
            </div>
            <div class="realtime-stats">
                <div class="realtime-stat">
                    <span class="realtime-number" id="activeVisitorCount">{{ active_visitor_count }}</span>
                    <span class="realtime-label">Visiteurs actifs</span>
                </div>
                <div class="realtime-visitors-list" id="activeVisitorsList">
                    {% for visitor in active_visitors_list %}
                    <div class="active-visitor">
                        <span class="visitor-flag">üåç</span>
                        <span class="visitor-country">{{ visitor.country|default:"Inconnu" }}</span>
                        <span class="visitor-page">{{ visitor.current_page|truncatechars:30 }}</span>
                        <span class="visitor-device">{{ visitor.device_type }}</span>
                        {% if visitor.user__username %}
                        <span class="visitor-user">{{ visitor.user__username }}</span>
                        {% endif %}
                    </div>
                    {% empty %}
                    <p class="no-visitors">Aucun visiteur actif</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <!-- Quick Stats Grid -->
    <section class="quick-stats-section">
        <h2 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="20" x2="18" y2="10"/>
                <line x1="12" y1="20" x2="12" y2="4"/>
                <line x1="6" y1="20" x2="6" y2="14"/>
            </svg>
            Vue d'ensemble
        </h2>
        <div class="quick-stats-grid">
            <!-- Users Stats -->
            <div class="stat-card stat-users">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                        <circle cx="9" cy="7" r="4"/>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ total_users }}</span>
                    <span class="stat-label">Utilisateurs</span>
                    <div class="stat-details">
                        <span class="stat-change positive">+{{ new_users_today }} aujourd'hui</span>
                        <span class="stat-sub">+{{ new_users_week }} cette semaine</span>
                    </div>
                </div>
            </div>

            <!-- Postcards Stats -->
            <div class="stat-card stat-postcards">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ total_postcards }}</span>
                    <span class="stat-label">Cartes Postales</span>
                    <div class="stat-details">
                        <span class="stat-sub">{{ postcards_with_images }} avec images</span>
                        <span class="stat-sub">{{ animated_postcards }} anim√©es</span>
                    </div>
                </div>
            </div>

            <!-- Page Views Stats -->
            <div class="stat-card stat-views">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ views_today }}</span>
                    <span class="stat-label">Vues aujourd'hui</span>
                    <div class="stat-details">
                        <span class="stat-sub">{{ views_week }} cette semaine</span>
                        <span class="stat-sub">{{ total_views }} total</span>
                    </div>
                </div>
            </div>

            <!-- Likes Stats -->
            <div class="stat-card stat-likes">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ total_likes }}</span>
                    <span class="stat-label">Likes Total</span>
                    <div class="stat-details">
                        <span class="stat-change positive">+{{ likes_today }} aujourd'hui</span>
                        <span class="stat-sub">+{{ likes_week }} cette semaine</span>
                    </div>
                </div>
            </div>

            <!-- Searches Stats -->
            <div class="stat-card stat-searches">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"/>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ searches_today }}</span>
                    <span class="stat-label">Recherches aujourd'hui</span>
                    <div class="stat-details">
                        <span class="stat-sub">{{ searches_week }} cette semaine</span>
                        <span class="stat-sub">{{ total_searches }} total</span>
                    </div>
                </div>
            </div>

            <!-- Sessions Stats -->
            <div class="stat-card stat-sessions">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                        <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                        <line x1="12" y1="22.08" x2="12" y2="12"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ sessions_today }}</span>
                    <span class="stat-label">Sessions aujourd'hui</span>
                    <div class="stat-details">
                        <span class="stat-sub">{{ unique_visitors_today }} visiteurs uniques</span>
                        <span class="stat-sub">{{ unique_visitors_week }} cette semaine</span>
                    </div>
                </div>
            </div>

            <!-- Messages Stats -->
            <div class="stat-card stat-messages {% if unread_messages > 0 %}has-alert{% endif %}">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ total_messages }}</span>
                    <span class="stat-label">Messages</span>
                    <div class="stat-details">
                        {% if unread_messages > 0 %}
                        <span class="stat-change alert">{{ unread_messages }} non lus</span>
                        {% endif %}
                        <span class="stat-sub">{{ messages_today }} aujourd'hui</span>
                    </div>
                </div>
            </div>

            <!-- Suggestions Stats -->
            <div class="stat-card stat-suggestions {% if pending_suggestions > 0 %}has-alert{% endif %}">
                <div class="stat-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 18h6"/>
                        <path d="M10 22h4"/>
                        <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/>
                    </svg>
                </div>
                <div class="stat-content">
                    <span class="stat-value">{{ total_suggestions }}</span>
                    <span class="stat-label">Suggestions</span>
                    <div class="stat-details">
                        {% if pending_suggestions > 0 %}
                        <span class="stat-change alert">{{ pending_suggestions }} en attente</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Performance Metrics -->
    <section class="performance-section">
        <h2 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
            </svg>
            M√©triques de Performance
        </h2>
        <div class="performance-grid">
            <div class="performance-card">
                <div class="performance-icon bounce-rate">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        <polyline points="17 6 23 6 23 12"/>
                    </svg>
                </div>
                <div class="performance-info">
                    <span class="performance-value">{{ bounce_rate }}%</span>
                    <span class="performance-label">Taux de rebond</span>
                </div>
                <div class="performance-bar">
                    <div class="performance-fill" style="width: {{ bounce_rate }}%"></div>
                </div>
            </div>

            <div class="performance-card">
                <div class="performance-icon session-duration">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <polyline points="12 6 12 12 16 14"/>
                    </svg>
                </div>
                <div class="performance-info">
                    <span class="performance-value">{{ avg_session_duration }}s</span>
                    <span class="performance-label">Dur√©e moyenne session</span>
                </div>
            </div>

            <div class="performance-card">
                <div class="performance-icon pages-session">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                    </svg>
                </div>
                <div class="performance-info">
                    <span class="performance-value">{{ pages_per_session }}</span>
                    <span class="performance-label">Pages par session</span>
                </div>
            </div>
        </div>
    </section>

    <!-- Charts Section -->
    <section class="charts-section">
        <div class="charts-grid">
            <!-- Activity Chart -->
            <div class="chart-card chart-large">
                <div class="chart-header">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <line x1="18" y1="20" x2="18" y2="10"/>
                            <line x1="12" y1="20" x2="12" y2="4"/>
                            <line x1="6" y1="20" x2="6" y2="14"/>
                        </svg>
                        Activit√© des 30 derniers jours
                    </h3>
                    <div class="chart-legend">
                        <span class="legend-item legend-views">Vues</span>
                        <span class="legend-item legend-sessions">Sessions</span>
                        <span class="legend-item legend-searches">Recherches</span>
                        <span class="legend-item legend-likes">Likes</span>
                    </div>
                </div>
                <canvas id="activityChart"></canvas>
            </div>

            <!-- Users Distribution Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21.21 15.89A10 10 0 1 1 8 2.83"/>
                            <path d="M22 12A10 10 0 0 0 12 2v10z"/>
                        </svg>
                        R√©partition Utilisateurs
                    </h3>
                </div>
                <canvas id="usersChart"></canvas>
                <div class="chart-stats">
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #6c757d;"></span>
                        <span>Non v√©rifi√©s: {{ user_categories.unverified }}</span>
                    </div>
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #28a745;"></span>
                        <span>V√©rifi√©s: {{ user_categories.verified }}</span>
                    </div>
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #b5600b;"></span>
                        <span>Facteurs: {{ user_categories.postman }}</span>
                    </div>
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #d1872c;"></span>
                        <span>Visiteurs: {{ user_categories.viewer }}</span>
                    </div>
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #ffc168;"></span>
                        <span>Staff: {{ user_categories.staff }}</span>
                    </div>
                </div>
            </div>

            <!-- Device Distribution Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="5" y="2" width="14" height="20" rx="2" ry="2"/>
                            <line x1="12" y1="18" x2="12.01" y2="18"/>
                        </svg>
                        Appareils
                    </h3>
                </div>
                <canvas id="devicesChart"></canvas>
                <div class="chart-stats">
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #17a2b8;"></span>
                        <span>Mobile: {{ device_breakdown.mobile }}</span>
                    </div>
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #28a745;"></span>
                        <span>Desktop: {{ device_breakdown.desktop }}</span>
                    </div>
                    <div class="chart-stat">
                        <span class="chart-stat-color" style="background: #ffc107;"></span>
                        <span>Tablette: {{ device_breakdown.tablet }}</span>
                    </div>
                </div>
            </div>

            <!-- Hourly Traffic Chart -->
            <div class="chart-card">
                <div class="chart-header">
                    <h3>
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <polyline points="12 6 12 12 16 14"/>
                        </svg>
                        Trafic par heure (aujourd'hui)
                    </h3>
                </div>
                <canvas id="hourlyChart"></canvas>
            </div>
        </div>
    </section>

    <!-- Geographic Section -->
    <section class="geographic-section">
        <h2 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="10"/>
                <line x1="2" y1="12" x2="22" y2="12"/>
                <path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/>
            </svg>
            G√©ographie des Visiteurs
        </h2>
        <div class="geographic-grid">
            <!-- Top Countries -->
            <div class="geo-card">
                <h3>Top Pays</h3>
                <div class="geo-list">
                    {% for country in top_countries %}
                    <div class="geo-item">
                        <span class="geo-name">{{ country.country }}</span>
                        <span class="geo-count">{{ country.count }}</span>
                        <div class="geo-bar">
                            <div class="geo-bar-fill" style="width: {% widthratio country.count top_countries.0.count 100 %}%"></div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune donn√©e disponible</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Top Cities -->
            <div class="geo-card">
                <h3>Top Villes</h3>
                <div class="geo-list">
                    {% for city in top_cities %}
                    <div class="geo-item">
                        <span class="geo-name">{{ city.city }}, {{ city.country }}</span>
                        <span class="geo-count">{{ city.count }}</span>
                        <div class="geo-bar">
                            <div class="geo-bar-fill" style="width: {% widthratio city.count top_cities.0.count 100 %}%"></div>
                        </div>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune donn√©e disponible</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Today's Countries -->
            <div class="geo-card">
                <h3>Pays aujourd'hui</h3>
                <div class="geo-list">
                    {% for country in countries_today %}
                    <div class="geo-item">
                        <span class="geo-name">{{ country.country }}</span>
                        <span class="geo-count">{{ country.count }}</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucun visiteur aujourd'hui</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <!-- Traffic Sources Section -->
    <section class="traffic-section">
        <h2 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
                <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
            </svg>
            Sources de Trafic
        </h2>
        <div class="traffic-grid">
            <!-- Traffic Type -->
            <div class="traffic-card">
                <h3>Type de Trafic</h3>
                <div class="traffic-stats">
                    <div class="traffic-stat">
                        <span class="traffic-label">Direct</span>
                        <span class="traffic-value">{{ direct_traffic }}</span>
                    </div>
                    <div class="traffic-stat">
                        <span class="traffic-label">R√©f√©rent</span>
                        <span class="traffic-value">{{ referral_traffic }}</span>
                    </div>
                </div>
            </div>

            <!-- Top Referrers -->
            <div class="traffic-card traffic-card-large">
                <h3>Top R√©f√©rents</h3>
                <div class="referrers-list">
                    {% for ref in top_referrers %}
                    <div class="referrer-item">
                        <span class="referrer-domain">{{ ref.referrer_domain }}</span>
                        <span class="referrer-count">{{ ref.count }} visites</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucun r√©f√©rent externe</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Top Browsers -->
            <div class="traffic-card">
                <h3>Navigateurs</h3>
                <div class="browsers-list">
                    {% for browser in top_browsers %}
                    <div class="browser-item">
                        <span class="browser-name">{{ browser.browser }}</span>
                        <span class="browser-count">{{ browser.count }}</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune donn√©e</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Top OS -->
            <div class="traffic-card">
                <h3>Syst√®mes d'exploitation</h3>
                <div class="os-list">
                    {% for os in top_os %}
                    <div class="os-item">
                        <span class="os-name">{{ os.os }}</span>
                        <span class="os-count">{{ os.count }}</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune donn√©e</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <!-- Search Analytics Section -->
    <section class="search-section">
        <h2 class="section-title">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
            </svg>
            Analytique des Recherches
        </h2>
        <div class="search-grid">
            <!-- Top Searches All Time -->
            <div class="search-card">
                <h3>Top Recherches (Tout temps)</h3>
                <div class="search-list">
                    {% for search in top_searches_all %}
                    <div class="search-item">
                        <span class="search-keyword">{{ search.keyword }}</span>
                        <div class="search-stats">
                            <span class="search-count">{{ search.count }}x</span>
                            <span class="search-avg">~{{ search.avg_results|floatformat:0 }} r√©sultats</span>
                        </div>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune recherche enregistr√©e</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Top Searches Today -->
            <div class="search-card">
                <h3>Recherches du jour</h3>
                <div class="search-list">
                    {% for search in top_searches_today %}
                    <div class="search-item">
                        <span class="search-keyword">{{ search.keyword }}</span>
                        <span class="search-count">{{ search.count }}x</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune recherche aujourd'hui</p>
                    {% endfor %}
                </div>
            </div>

            <!-- Zero Result Searches -->
            <div class="search-card search-card-alert">
                <h3>
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="10"/>
                        <line x1="12" y1="8" x2="12" y2="12"/>
                        <line x1="12" y1="16" x2="12.01" y2="16"/>
                    </svg>
                    Recherches sans r√©sultat
                </h3>
                <div class="search-list">
                    {% for search in zero_result_searches %}
                    <div class="search-item search-item-alert">
                        <span class="search-keyword">{{ search.keyword }}</span>
                        <span class="search-count">{{ search.count }}x</span>
                    </div>
                    {% empty %}
                    <p class="no-data success">Aucune recherche sans r√©sultat! üéâ</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>

    <!-- Content Tabs Section -->
    <section class="tabs-section">
        <div class="tabs-header">
            <button class="tab-btn active" onclick="showTab('users')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/>
                    <circle cx="9" cy="7" r="4"/>
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87"/>
                    <path d="M16 3.13a4 4 0 0 1 0 7.75"/>
                </svg>
                Utilisateurs
            </button>
            <button class="tab-btn" onclick="showTab('postcards')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <circle cx="8.5" cy="8.5" r="1.5"/>
                    <polyline points="21 15 16 10 5 21"/>
                </svg>
                Cartes Postales
            </button>
            <button class="tab-btn" onclick="showTab('suggestions')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18h6"/>
                    <path d="M10 22h4"/>
                    <path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/>
                </svg>
                Suggestions
                {% if pending_suggestions > 0 %}
                <span class="tab-badge">{{ pending_suggestions }}</span>
                {% endif %}
            </button>
            <button class="tab-btn" onclick="showTab('messages')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                Messages
                {% if unread_messages > 0 %}
                <span class="tab-badge">{{ unread_messages }}</span>
                {% endif %}
            </button>
            <button class="tab-btn" onclick="showTab('likes')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                </svg>
                Likes
            </button>
            <button class="tab-btn" onclick="showTab('ips')">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                    <circle cx="12" cy="10" r="3"/>
                </svg>
                Adresses IP
            </button>
        </div>

        <!-- Users Tab -->
        <div class="tab-content active" id="users-tab">
            <div class="tab-header-bar">
                <h3>Gestion des Utilisateurs</h3>
                <div class="user-category-badges">
                    <span class="badge badge-unverified">Non v√©rifi√©s: {{ user_categories.unverified }}</span>
                    <span class="badge badge-verified">V√©rifi√©s: {{ user_categories.verified }}</span>
                    <span class="badge badge-postman">Facteurs: {{ user_categories.postman }}</span>
                    <span class="badge badge-viewer">Visiteurs: {{ user_categories.viewer }}</span>
                    <span class="badge badge-staff">Staff: {{ user_categories.staff }}</span>
                </div>
            </div>
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Utilisateur</th>
                            <th>Email</th>
                            <th>Cat√©gorie</th>
                            <th>Staff</th>
                            <th>Inscrit le</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in recent_users %}
                        <tr data-user-id="{{ u.id }}">
                            <td>
                                <div class="user-cell">
                                    <div class="user-avatar">{{ u.username|slice:":1"|upper }}</div>
                                    <span>{{ u.username }}</span>
                                </div>
                            </td>
                            <td>{{ u.email }}</td>
                            <td>
                                <select class="category-select" onchange="updateUserCategory({{ u.id }}, this.value)">
                                    {% for value, label in user_categories_choices %}
                                    <option value="{{ value }}" {% if u.category == value %}selected{% endif %}>{{ label }}</option>
                                    {% endfor %}
                                </select>
                            </td>
                            <td>
                                <span class="badge {% if u.is_staff %}badge-success{% else %}badge-muted{% endif %}">
                                    {{ u.is_staff|yesno:"Oui,Non" }}
                                </span>
                            </td>
                            <td>{{ u.date_joined|date:"d/m/Y H:i" }}</td>
                            <td>
                                {% if not u.is_superuser %}
                                <button class="btn-icon btn-danger" onclick="deleteUser({{ u.id }}, '{{ u.username }}')" title="Supprimer">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <polyline points="3 6 5 6 21 6"/>
                                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                                    </svg>
                                </button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            <button class="btn-primary" onclick="loadAllUsers()">Charger tous les utilisateurs</button>
        </div>

        <!-- Postcards Tab -->
        <div class="tab-content" id="postcards-tab">
            <div class="tab-header-bar">
                <h3>Gestion des Cartes Postales</h3>
                <button class="btn-primary" onclick="showAddPostcardModal()">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="12" y1="5" x2="12" y2="19"/>
                        <line x1="5" y1="12" x2="19" y2="12"/>
                    </svg>
                    Ajouter une carte
                </button>
            </div>
            
            <!-- Top Postcards Display -->
            <div class="postcards-preview">
                <h4>Cartes les plus vues</h4>
                <div class="postcards-scroll">
                    {% for p in top_viewed_postcards %}
                    <div class="postcard-mini" onclick="showPostcardAnalytics({{ p.id }})">
                        <span class="postcard-rank">#{{ forloop.counter }}</span>
                        <span class="postcard-number">N¬∞ {{ p.number }}</span>
                        <span class="postcard-views">{{ p.views_count }} vues</span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <div class="postcards-preview">
                <h4>Cartes les plus aim√©es</h4>
                <div class="postcards-scroll">
                    {% for p in top_liked_postcards %}
                    <div class="postcard-mini" onclick="showPostcardAnalytics({{ p.id }})">
                        <span class="postcard-rank">#{{ forloop.counter }}</span>
                        <span class="postcard-number">N¬∞ {{ p.number }}</span>
                        <span class="postcard-likes">
                            <svg width="12" height="12" viewBox="0 0 24 24" fill="#ff6b6b" stroke="none">
                                <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                            </svg>
                            {{ p.likes_count }}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Rarity Stats -->
            <div class="rarity-stats">
                <h4>Statistiques par raret√©</h4>
                <div class="rarity-grid">
                    <div class="rarity-card rarity-common">
                        <span class="rarity-label">Communes</span>
                        <span class="rarity-views">{{ rarity_stats.common.total_views|default:0 }} vues</span>
                        <span class="rarity-likes">{{ rarity_stats.common.total_likes|default:0 }} likes</span>
                    </div>
                    <div class="rarity-card rarity-rare">
                        <span class="rarity-label">Rares</span>
                        <span class="rarity-views">{{ rarity_stats.rare.total_views|default:0 }} vues</span>
                        <span class="rarity-likes">{{ rarity_stats.rare.total_likes|default:0 }} likes</span>
                    </div>
                    <div class="rarity-card rarity-very-rare">
                        <span class="rarity-label">Tr√®s Rares</span>
                        <span class="rarity-views">{{ rarity_stats.very_rare.total_views|default:0 }} vues</span>
                        <span class="rarity-likes">{{ rarity_stats.very_rare.total_likes|default:0 }} likes</span>
                    </div>
                </div>
            </div>
            
            <div class="table-container" id="postcards-table-container">
                <p class="load-prompt">Cliquez sur "Charger les cartes" pour afficher la liste compl√®te</p>
            </div>
            <button class="btn-primary" onclick="loadPostcards()">Charger les cartes postales</button>
        </div>

        <!-- Suggestions Tab -->
        <div class="tab-content" id="suggestions-tab">
            <div class="tab-header-bar">
                <h3>Suggestions d'Animation</h3>
                <span class="tab-count">{{ total_suggestions }} total ‚Ä¢ {{ pending_suggestions }} en attente</span>
            </div>
            <div class="suggestions-list">
                {% for s in recent_suggestions %}
                <div class="suggestion-item {% if s.status == 'pending' %}pending{% elif s.status == 'approved' %}approved{% elif s.status == 'rejected' %}rejected{% endif %}" data-id="{{ s.id }}">
                    <div class="suggestion-header">
                        <span class="suggestion-postcard">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                            </svg>
                            N¬∞ {{ s.postcard.number }}
                        </span>
                        <span class="suggestion-user">
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            {{ s.user.username|default:"Anonyme" }}
                        </span>
                        <span class="suggestion-date">{{ s.created_at|date:"d/m/Y H:i" }}</span>
                    </div>
                    <p class="suggestion-description">{{ s.description }}</p>
                    <div class="suggestion-actions">
                        <select class="status-select" onchange="updateSuggestionStatus({{ s.id }}, this.value)">
                            <option value="pending" {% if s.status == 'pending' %}selected{% endif %}>En attente</option>
                            <option value="reviewed" {% if s.status == 'reviewed' %}selected{% endif %}>Examin√©</option>
                            <option value="approved" {% if s.status == 'approved' %}selected{% endif %}>Approuv√©</option>
                            <option value="rejected" {% if s.status == 'rejected' %}selected{% endif %}>Rejet√©</option>
                        </select>
                    </div>
                </div>
                {% empty %}
                <p class="no-data">Aucune suggestion pour le moment.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Messages Tab -->
        <div class="tab-content" id="messages-tab">
            <div class="tab-header-bar">
                <h3>Messages de Contact</h3>
                <span class="tab-count">{{ total_messages }} total ‚Ä¢ {{ unread_messages }} non lus</span>
            </div>
            <div class="messages-list">
                {% for msg in recent_messages %}
                <div class="message-item {% if not msg.is_read %}unread{% endif %}">
                    <div class="message-header">
                        <span class="message-user">
                            {% if msg.user %}
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                                <circle cx="12" cy="7" r="4"/>
                            </svg>
                            {{ msg.user.username }}
                            {% else %}
                            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/>
                                <line x1="12" y1="17" x2="12.01" y2="17"/>
                            </svg>
                            Anonyme
                            {% endif %}
                        </span>
                        <span class="message-date">{{ msg.created_at|date:"d/m/Y H:i" }}</span>
                        {% if not msg.is_read %}
                        <span class="new-badge">Nouveau</span>
                        {% endif %}
                    </div>
                    <p class="message-content">{{ msg.message }}</p>
                    <div class="message-footer">
                        <span class="message-ip">IP: {{ msg.ip_address|default:"N/A" }}</span>
                    </div>
                </div>
                {% empty %}
                <p class="no-data">Aucun message re√ßu.</p>
                {% endfor %}
            </div>
        </div>

        <!-- Likes Tab -->
        <div class="tab-content" id="likes-tab">
            <div class="tab-header-bar">
                <h3>Derniers Likes</h3>
                <span class="tab-count">{{ total_likes }} total</span>
            </div>
            <div class="likes-list">
                {% for like in recent_likes %}
                <div class="like-item">
                    <span class="like-icon">
                        {% if like.is_animated_like %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="#ffc168" stroke-width="2">
                            <polygon points="5 3 19 12 5 21 5 3"/>
                        </svg>
                        {% else %}
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="#ff6b6b" stroke="none">
                            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                        </svg>
                        {% endif %}
                    </span>
                    <span class="like-postcard">N¬∞ {{ like.postcard.number }}</span>
                    <span class="like-user">{{ like.user.username|default:"Anonyme" }}</span>
                    <span class="like-date">{{ like.created_at|date:"d/m/Y H:i" }}</span>
                </div>
                {% empty %}
                <p class="no-data">Aucun like enregistr√©.</p>
                {% endfor %}
            </div>
        </div>

        <!-- IPs Tab -->
        <div class="tab-content" id="ips-tab">
            <div class="tab-header-bar">
                <h3>Analyse des Adresses IP</h3>
                <span class="tab-count">{{ vpn_proxy_count }} VPN/Proxy d√©tect√©s</span>
            </div>
            
            <div class="ips-section">
                <h4>IPs les plus actives</h4>
                <div class="ips-list">
                    {% for ip in most_active_ips %}
                    <div class="ip-item" onclick="lookupIP('{{ ip.ip_address }}')">
                        <div class="ip-main">
                            <span class="ip-address">{{ ip.ip_address }}</span>
                            <span class="ip-location">{{ ip.city }}, {{ ip.country }}</span>
                        </div>
                        <div class="ip-stats">
                            <span class="ip-sessions">{{ ip.session_count }} sessions</span>
                            <span class="ip-views">{{ ip.total_page_views|default:0 }} vues</span>
                        </div>
                        <span class="ip-isp">{{ ip.isp|truncatechars:30 }}</span>
                    </div>
                    {% empty %}
                    <p class="no-data">Aucune donn√©e IP disponible</p>
                    {% endfor %}
                </div>
            </div>

            <div class="ips-section">
                <h4>IPs suspectes (nombreuses sessions)</h4>
                <div class="ips-list">
                    {% for ip in suspicious_ips %}
                    <div class="ip-item suspicious" onclick="lookupIP('{{ ip.ip_address }}')">
                        <div class="ip-main">
                            <span class="ip-address">{{ ip.ip_address }}</span>
                            <span class="ip-location">{{ ip.country }}</span>
                        </div>
                        <div class="ip-stats">
                            <span class="ip-sessions warning">{{ ip.count }} sessions</span>
                            {% if ip.is_bot %}
                            <span class="ip-bot">Bot</span>
                            {% endif %}
                        </div>
                    </div>
                    {% empty %}
                    <p class="no-data success">Aucune IP suspecte d√©tect√©e üéâ</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
</div>

<!-- IP Lookup Modal -->
<div class="ip-modal" id="ipModal">
    <div class="modal-backdrop" onclick="closeIPModal()"></div>
    <div class="modal-content">
        <button class="modal-close" onclick="closeIPModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <h2>D√©tails IP</h2>
        <div id="ipModalContent">
            <div class="loading-spinner"></div>
        </div>
    </div>
</div>

<!-- Postcard Analytics Modal -->
<div class="postcard-modal" id="postcardModal">
    <div class="modal-backdrop" onclick="closePostcardModal()"></div>
    <div class="modal-content modal-large">
        <button class="modal-close" onclick="closePostcardModal()">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="18" y1="6" x2="6" y2="18"/>
                <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
        </button>
        <h2>Analytique Carte Postale</h2>
        <div id="postcardModalContent">
            <div class="loading-spinner"></div>
        </div>
    </div>
</div>

<!-- Include Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const csrfToken = '{{ csrf_token }}';
const dailyStats = {{ daily_stats|safe }};
const hourlyTraffic = {{ hourly_traffic|safe }};

// Tab functionality
function showTab(tabName) {
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });
    document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
    });
    
    event.target.closest('.tab-btn').classList.add('active');
    document.getElementById(tabName + '-tab').classList.add('active');
}

// Export menu toggle
function toggleExportMenu() {
    document.getElementById('exportMenu').classList.toggle('show');
}

// Close export menu when clicking outside
document.addEventListener('click', (e) => {
    if (!e.target.closest('.export-dropdown')) {
        document.getElementById('exportMenu').classList.remove('show');
    }
});

// User management
async function updateUserCategory(userId, category) {
    try {
        const response = await fetch(`/api/admin/user/${userId}/`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ category })
        });
        
        if (response.ok) {
            showNotification('Cat√©gorie mise √† jour', 'success');
        } else {
            showNotification('Erreur lors de la mise √† jour', 'error');
        }
    } catch (error) {
        showNotification('Erreur de connexion', 'error');
    }
}

async function deleteUser(userId, username) {
    if (!confirm(`√ätes-vous s√ªr de vouloir supprimer l'utilisateur "${username}" ?`)) {
        return;
    }
    
    try {
        const response = await fetch(`/api/admin/user/${userId}/`, {
            method: 'DELETE',
            headers: { 'X-CSRFToken': csrfToken }
        });
        
        if (response.ok) {
            document.querySelector(`tr[data-user-id="${userId}"]`).remove();
            showNotification('Utilisateur supprim√©', 'success');
        } else {
            showNotification('Erreur lors de la suppression', 'error');
        }
    } catch (error) {
        showNotification('Erreur de connexion', 'error');
    }
}

async function loadAllUsers() {
    try {
        const response = await fetch('/api/admin/users/');
        const data = await response.json();
        
        const tbody = document.querySelector('#users-tab tbody');
        tbody.innerHTML = data.users.map(u => `
            <tr data-user-id="${u.id}">
                <td>
                    <div class="user-cell">
                        <div class="user-avatar">${u.username.charAt(0).toUpperCase()}</div>
                        <span>${u.username}</span>
                    </div>
                </td>
                <td>${u.email}</td>
                <td>
                    <select class="category-select" onchange="updateUserCategory(${u.id}, this.value)">
                        <option value="subscribed_unverified" ${u.category === 'subscribed_unverified' ? 'selected' : ''}>Inscrit - Non v√©rifi√©</option>
                        <option value="subscribed_verified" ${u.category === 'subscribed_verified' ? 'selected' : ''}>Inscrit - V√©rifi√©</option>
                        <option value="postman" ${u.category === 'postman' ? 'selected' : ''}>Facteur</option>
                        <option value="viewer" ${u.category === 'viewer' ? 'selected' : ''}>Visiteur privil√©gi√©</option>
                    </select>
                </td>
                <td><span class="badge ${u.is_staff ? 'badge-success' : 'badge-muted'}">${u.is_staff ? 'Oui' : 'Non'}</span></td>
                <td>${u.date_joined}</td>
                <td>
                    <button class="btn-icon btn-danger" onclick="deleteUser(${u.id}, '${u.username}')" title="Supprimer">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="3 6 5 6 21 6"/>
                            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        </svg>
                    </button>
                </td>
            </tr>
        `).join('');
        
        showNotification('Utilisateurs charg√©s', 'success');
    } catch (error) {
        showNotification('Erreur lors du chargement', 'error');
    }
}

// Suggestion management
async function updateSuggestionStatus(suggestionId, status) {
    try {
        const response = await fetch(`/api/admin/suggestion/${suggestionId}/`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrfToken
            },
            body: JSON.stringify({ status })
        });
        
        if (response.ok) {
            const item = document.querySelector(`.suggestion-item[data-id="${suggestionId}"]`);
            item.className = `suggestion-item ${status}`;
            showNotification('Statut mis √† jour', 'success');
        }
    } catch (error) {
        showNotification('Erreur', 'error');
    }
}

// Postcards management
async function loadPostcards() {
    try {
        const response = await fetch('/api/admin/postcards/');
        const data = await response.json();
        
        const container = document.getElementById('postcards-table-container');
        container.innerHTML = `
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Num√©ro</th>
                        <th>Titre</th>
                        <th>Raret√©</th>
                        <th>Vues</th>
                        <th>Likes</th>
                        <th>Images</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    ${data.postcards.map(p => `
                        <tr>
                            <td>${p.number}</td>
                            <td>${p.title}</td>
                            <td><span class="rarity-badge rarity-${p.rarity}">${p.rarity}</span></td>
                            <td>${p.views_count}</td>
                            <td>${p.likes_count}</td>
                            <td>
                                ${p.has_vignette ? '‚úì' : '‚úó'} Vignette
                            </td>
                            <td>
                                <button class="btn-icon" onclick="showPostcardAnalytics(${p.id})" title="Analytique">
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="20" x2="18" y2="10"/>
                                        <line x1="12" y1="20" x2="12" y2="4"/>
                                        <line x1="6" y1="20" x2="6" y2="14"/>
                                    </svg>
                                </button>
                            </td>
                        </tr>
                    `).join('')}
                </tbody>
            </table>
            <p class="table-info">${data.total} cartes postales au total</p>
        `;
        
        showNotification('Cartes charg√©es', 'success');
    } catch (error) {
        showNotification('Erreur lors du chargement', 'error');
    }
}

// IP Lookup
async function lookupIP(ipAddress) {
    document.getElementById('ipModal').classList.add('active');
    document.getElementById('ipModalContent').innerHTML = '<div class="loading-spinner"></div>';
    
    try {
        const response = await fetch(`/api/admin/ip/${ipAddress}/`);
        const data = await response.json();
        
        document.getElementById('ipModalContent').innerHTML = `
            <div class="ip-details">
                <div class="ip-detail-section">
                    <h4>Localisation</h4>
                    <p><strong>IP:</strong> ${data.ip_address}</p>
                    <p><strong>Pays:</strong> ${data.location.country} (${data.location.country_code})</p>
                    <p><strong>Ville:</strong> ${data.location.city}</p>
                    <p><strong>R√©gion:</strong> ${data.location.region}</p>
                    <p><strong>FAI:</strong> ${data.location.isp}</p>
                    <p><strong>Fuseau:</strong> ${data.location.timezone}</p>
                    ${data.location.is_vpn ? '<p class="warning">‚ö†Ô∏è VPN/Hosting d√©tect√©</p>' : ''}
                    ${data.location.is_proxy ? '<p class="warning">‚ö†Ô∏è Proxy d√©tect√©</p>' : ''}
                </div>
                <div class="ip-detail-section">
                    <h4>Statistiques</h4>
                    <p><strong>Sessions totales:</strong> ${data.total_sessions}</p>
                    <p><strong>Pages vues totales:</strong> ${data.total_page_views}</p>
                </div>
                <div class="ip-detail-section">
                    <h4>Sessions r√©centes</h4>
                    <div class="sessions-list">
                        ${data.sessions.map(s => `
                            <div class="session-item">
                                <span>${s.first_visit}</span>
                                <span>${s.device_type} - ${s.browser}</span>
                                <span>${s.page_views} pages</span>
                                ${s.user__username ? `<span class="session-user">${s.user__username}</span>` : ''}
                            </div>
                        `).join('')}
                    </div>
                </div>
            </div>
        `;
    } catch (error) {
        document.getElementById('ipModalContent').innerHTML = '<p class="error">Erreur lors du chargement</p>';
    }
}

function closeIPModal() {
    document.getElementById('ipModal').classList.remove('active');
}

// Postcard Analytics
async function showPostcardAnalytics(postcardId) {
    document.getElementById('postcardModal').classList.add('active');
    document.getElementById('postcardModalContent').innerHTML = '<div class="loading-spinner"></div>';
    
    try {
        const response = await fetch(`/api/admin/postcard-analytics/${postcardId}/`);
        const data = await response.json();
        
        document.getElementById('postcardModalContent').innerHTML = `
            <div class="postcard-analytics">
                <div class="postcard-info-section">
                    <div class="postcard-preview">
                        ${data.postcard.vignette_url ? `<img src="${data.postcard.vignette_url}" alt="Carte">` : '<div class="no-image">Pas d\'image</div>'}
                    </div>
                    <div class="postcard-meta">
                        <h3>N¬∞ ${data.postcard.number}</h3>
                        <p>${data.postcard.title}</p>
                        <span class="rarity-badge rarity-${data.postcard.rarity}">${data.postcard.rarity}</span>
                        ${data.postcard.has_animation ? '<span class="animation-badge">Anim√©e</span>' : ''}
                    </div>
                </div>
                <div class="analytics-stats">
                    <div class="analytics-stat">
                        <span class="stat-value">${data.postcard.views_count}</span>
                        <span class="stat-label">Vues</span>
                    </div>
                    <div class="analytics-stat">
                        <span class="stat-value">${data.postcard.zoom_count}</span>
                        <span class="stat-label">Zooms</span>
                    </div>
                    <div class="analytics-stat">
                        <span class="stat-value">${data.postcard.likes_count}</span>
                        <span class="stat-label">Likes</span>
                    </div>
                </div>
                <div class="analytics-section">
                    <h4>Interactions</h4>
                    <div class="interactions-breakdown">
                        ${Object.entries(data.interaction_types).map(([type, count]) => `
                            <div class="interaction-item">
                                <span>${type}</span>
                                <span>${count}</span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                <div class="analytics-section">
                    <h4>Top Pays</h4>
                    <div class="country-breakdown">
                        ${data.country_breakdown.map(c => `
                            <div class="country-item">
                                <span>${c.country}</span>
                                <span>${c.count} vues</span>
                            </div>
                        `).join('') || '<p class="no-data">Aucune donn√©e</p>'}
                    </div>
                </div>
                <div class="analytics-section">
                    <h4>Derniers likes</h4>
                    <div class="likes-breakdown">
                        ${data.recent_likes.map(l => `
                            <div class="like-item-detail">
                                <span>${l.user__username || 'Anonyme'}</span>
                                <span>${l.created_at}</span>
                                ${l.is_animated_like ? '<span class="animation-like">Animation</span>' : ''}
                            </div>
                        `).join('') || '<p class="no-data">Aucun like</p>'}
                    </div>
                </div>
            </div>
        `;
    } catch (error) {
        document.getElementById('postcardModalContent').innerHTML = '<p class="error">Erreur lors du chargement</p>';
    }
}

function closePostcardModal() {
    document.getElementById('postcardModal').classList.remove('active');
}

// Real-time updates
function updateRealTimeVisitors() {
    fetch('/api/admin/realtime/')
        .then(response => response.json())
        .then(data => {
            document.getElementById('activeVisitorCount').textContent = data.count;
            
            const list = document.getElementById('activeVisitorsList');
            if (data.visitors.length > 0) {
                list.innerHTML = data.visitors.map(v => `
                    <div class="active-visitor">
                        <span class="visitor-flag">üåç</span>
                        <span class="visitor-country">${v.country || 'Inconnu'}</span>
                        <span class="visitor-page">${(v.current_page || '').substring(0, 30)}</span>
                        <span class="visitor-device">${v.device_type || ''}</span>
                        ${v.user__username ? `<span class="visitor-user">${v.user__username}</span>` : ''}
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<p class="no-visitors">Aucun visiteur actif</p>';
            }
        })
        .catch(error => console.log('Realtime update error:', error));
}

// Update every 30 seconds
setInterval(updateRealTimeVisitors, 30000);

// Notifications
function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.innerHTML = `
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            ${type === 'success' ? '<path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>' : '<circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/>'}
        </svg>
        ${message}
    `;
    document.body.appendChild(notification);
    setTimeout(() => notification.remove(), 3000);
}

// Initialize Charts
document.addEventListener('DOMContentLoaded', () => {
    // Activity Chart
    const activityCtx = document.getElementById('activityChart');
    if (activityCtx) {
        new Chart(activityCtx, {
            type: 'line',
            data: {
                labels: dailyStats.map(d => d.date),
                datasets: [
                    {
                        label: 'Vues',
                        data: dailyStats.map(d => d.views),
                        borderColor: '#b5600b',
                        backgroundColor: 'rgba(181, 96, 11, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Sessions',
                        data: dailyStats.map(d => d.sessions),
                        borderColor: '#28a745',
                        backgroundColor: 'rgba(40, 167, 69, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Recherches',
                        data: dailyStats.map(d => d.searches),
                        borderColor: '#17a2b8',
                        tension: 0.4
                    },
                    {
                        label: 'Likes',
                        data: dailyStats.map(d => d.likes),
                        borderColor: '#ff6b6b',
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });
    }

    // Users Chart
    const usersCtx = document.getElementById('usersChart');
    if (usersCtx) {
        new Chart(usersCtx, {
            type: 'doughnut',
            data: {
                labels: ['Non v√©rifi√©s', 'V√©rifi√©s', 'Facteurs', 'Visiteurs', 'Staff'],
                datasets: [{
                    data: [
                        {{ user_categories.unverified }},
                        {{ user_categories.verified }},
                        {{ user_categories.postman }},
                        {{ user_categories.viewer }},
                        {{ user_categories.staff }}
                    ],
                    backgroundColor: ['#6c757d', '#28a745', '#b5600b', '#d1872c', '#ffc168']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                cutout: '60%'
            }
        });
    }

    // Devices Chart
    const devicesCtx = document.getElementById('devicesChart');
    if (devicesCtx) {
        new Chart(devicesCtx, {
            type: 'doughnut',
            data: {
                labels: ['Mobile', 'Desktop', 'Tablette', 'Autre'],
                datasets: [{
                    data: [
                        {{ device_breakdown.mobile }},
                        {{ device_breakdown.desktop }},
                        {{ device_breakdown.tablet }},
                        {{ device_breakdown.other }}
                    ],
                    backgroundColor: ['#17a2b8', '#28a745', '#ffc107', '#6c757d']
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                cutout: '60%'
            }
        });
    }

    // Hourly Chart
    const hourlyCtx = document.getElementById('hourlyChart');
    if (hourlyCtx && hourlyTraffic.length > 0) {
        new Chart(hourlyCtx, {
            type: 'bar',
            data: {
                labels: hourlyTraffic.map(h => h.hour),
                datasets: [{
                    label: 'Vues',
                    data: hourlyTraffic.map(h => h.count),
                    backgroundColor: 'rgba(181, 96, 11, 0.7)',
                    borderColor: '#b5600b',
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: {
                            color: 'rgba(255, 255, 255, 0.1)'
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        },
                        ticks: {
                            color: 'rgba(255, 255, 255, 0.7)'
                        }
                    }
                }
            }
        });
    }
});

// Keyboard shortcuts
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        closeIPModal();
        closePostcardModal();
    }
});
</script>

<style>
/* Admin Dashboard Styles */
.admin-dashboard {
    min-height: 100vh;
    background: linear-gradient(180deg, #1a1208 0%, #2d1f0d 50%, #1a1208 100%);
    padding: 80px 20px 60px;
}

/* Header */
.dashboard-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 20px;
    max-width: 1400px;
    margin: 0 auto 40px;
    padding: 25px;
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.95), rgba(30, 20, 15, 0.98));
    border-radius: 16px;
    border: 1px solid rgba(181, 96, 11, 0.2);
}

.header-content {
    display: flex;
    align-items: center;
    gap: 20px;
}

.header-icon {
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #b5600b, #d1872c);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.header-icon svg {
    stroke: white;
}

.header-text h1 {
    color: white;
    font-size: 1.5rem;
    margin: 0 0 5px;
}

.header-text p {
    color: rgba(255, 255, 255, 0.7);
    margin: 0;
    font-size: 0.9rem;
}

.header-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.refresh-btn, .admin-link-btn, .export-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: white;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.3s;
    font-size: 0.9rem;
}

.refresh-btn:hover, .admin-link-btn:hover, .export-btn:hover {
    background: rgba(181, 96, 11, 0.3);
    border-color: #b5600b;
}

.export-dropdown {
    position: relative;
}

.export-menu {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 5px;
    background: #252525;
    border: 1px solid rgba(181, 96, 11, 0.3);
    border-radius: 8px;
    overflow: hidden;
    display: none;
    z-index: 100;
}

.export-menu.show {
    display: block;
}

.export-menu a {
    display: block;
    padding: 10px 20px;
    color: white;
    text-decoration: none;
    transition: background 0.2s;
    white-space: nowrap;
}

.export-menu a:hover {
    background: rgba(181, 96, 11, 0.3);
}

/* Real-time Section */
.realtime-section {
    max-width: 1400px;
    margin: 0 auto 30px;
}

.realtime-card {
    background: linear-gradient(135deg, rgba(74, 222, 128, 0.1), rgba(74, 222, 128, 0.05));
    border: 1px solid rgba(74, 222, 128, 0.3);
    border-radius: 16px;
    padding: 20px;
}

.realtime-indicator {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 15px;
    color: #4ade80;
    font-weight: 600;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}

.pulse-dot {
    width: 10px;
    height: 10px;
    background: #4ade80;
    border-radius: 50%;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

.realtime-stats {
    display: flex;
    align-items: flex-start;
    gap: 30px;
    flex-wrap: wrap;
}

.realtime-stat {
    text-align: center;
}

.realtime-number {
    display: block;
    font-size: 3rem;
    font-weight: 700;
    color: #4ade80;
}

.realtime-label {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.9rem;
}

.realtime-visitors-list {
    flex: 1;
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.active-visitor {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 8px;
    font-size: 0.85rem;
}

.visitor-flag {
    font-size: 1.1rem;
}

.visitor-country {
    color: #4ade80;
    font-weight: 500;
}

.visitor-page {
    color: rgba(255, 255, 255, 0.6);
}

.visitor-device {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.75rem;
}

.visitor-user {
    color: #ffc168;
    font-weight: 500;
}

.no-visitors {
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
}

/* Section Titles */
.section-title {
    display: flex;
    align-items: center;
    gap: 12px;
    color: white;
    font-size: 1.3rem;
    margin-bottom: 25px;
}

.section-title svg {
    stroke: #b5600b;
}

/* Quick Stats Grid */
.quick-stats-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}

.quick-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.stat-card {
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    display: flex;
    align-items: flex-start;
    gap: 20px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    transition: all 0.3s;
}

.stat-card:hover {
    border-color: rgba(181, 96, 11, 0.4);
    transform: translateY(-3px);
}

.stat-card.has-alert {
    border-color: rgba(248, 113, 113, 0.4);
}

.stat-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, rgba(181, 96, 11, 0.2), rgba(181, 96, 11, 0.1));
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.stat-icon svg {
    stroke: #ffc168;
}

.stat-content {
    flex: 1;
}

.stat-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: white;
}

.stat-label {
    display: block;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
    margin-bottom: 10px;
}

.stat-details {
    display: flex;
    flex-direction: column;
    gap: 3px;
}

.stat-change {
    font-size: 0.85rem;
    font-weight: 500;
}

.stat-change.positive {
    color: #4ade80;
}

.stat-change.alert {
    color: #f87171;
}

.stat-sub {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.8rem;
}

/* Performance Section */
.performance-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}

.performance-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
}

.performance-card {
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.performance-icon {
    width: 50px;
    height: 50px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 15px;
}

.performance-icon.bounce-rate {
    background: rgba(248, 113, 113, 0.2);
}

.performance-icon.bounce-rate svg {
    stroke: #f87171;
}

.performance-icon.session-duration {
    background: rgba(74, 222, 128, 0.2);
}

.performance-icon.session-duration svg {
    stroke: #4ade80;
}

.performance-icon.pages-session {
    background: rgba(96, 165, 250, 0.2);
}

.performance-icon.pages-session svg {
    stroke: #60a5fa;
}

.performance-value {
    display: block;
    font-size: 2rem;
    font-weight: 700;
    color: white;
}

.performance-label {
    display: block;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.9rem;
}

.performance-bar {
    height: 6px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 3px;
    margin-top: 15px;
    overflow: hidden;
}

.performance-fill {
    height: 100%;
    background: linear-gradient(90deg, #4ade80, #ffc107, #f87171);
    border-radius: 3px;
    transition: width 0.5s ease;
}

/* Charts Section */
.charts-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}

.charts-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
}

.chart-card {
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.chart-card.chart-large {
    grid-column: 1 / -1;
}

.chart-card canvas {
    max-height: 300px;
}

.chart-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    flex-wrap: wrap;
    gap: 10px;
}

.chart-header h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
    font-size: 1rem;
    margin: 0;
}

.chart-header h3 svg {
    stroke: #b5600b;
}

.chart-legend {
    display: flex;
    gap: 15px;
    flex-wrap: wrap;
}

.legend-item {
    font-size: 0.8rem;
    padding: 4px 10px;
    border-radius: 12px;
}

.legend-views { background: rgba(181, 96, 11, 0.2); color: #ffc168; }
.legend-sessions { background: rgba(40, 167, 69, 0.2); color: #4ade80; }
.legend-searches { background: rgba(23, 162, 184, 0.2); color: #17a2b8; }
.legend-likes { background: rgba(255, 107, 107, 0.2); color: #ff6b6b; }

.chart-stats {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    margin-top: 15px;
}

.chart-stat {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.8);
}

.chart-stat-color {
    width: 12px;
    height: 12px;
    border-radius: 3px;
}

/* Geographic Section */
.geographic-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}

.geographic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.geo-card {
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.geo-card h3 {
    color: white;
    font-size: 1rem;
    margin: 0 0 20px;
}

.geo-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    max-height: 300px;
    overflow-y: auto;
}

.geo-item {
    display: flex;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
}

.geo-name {
    flex: 1;
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
    min-width: 120px;
}

.geo-count {
    color: #b5600b;
    font-weight: 600;
    font-size: 0.9rem;
}

.geo-bar {
    width: 100%;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
}

.geo-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #b5600b, #ffc168);
    border-radius: 2px;
}

/* Traffic Section */
.traffic-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}

.traffic-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.traffic-card {
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.traffic-card.traffic-card-large {
    grid-column: span 2;
}

.traffic-card h3 {
    color: white;
    font-size: 1rem;
    margin: 0 0 20px;
}

.traffic-stats {
    display: flex;
    gap: 30px;
}

.traffic-stat {
    text-align: center;
}

.traffic-label {
    display: block;
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
    margin-bottom: 5px;
}

.traffic-value {
    display: block;
    font-size: 1.5rem;
    font-weight: 700;
    color: #b5600b;
}

.referrers-list, .browsers-list, .os-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 250px;
    overflow-y: auto;
}

.referrer-item, .browser-item, .os-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
}

.referrer-domain, .browser-name, .os-name {
    color: rgba(255, 255, 255, 0.9);
    font-size: 0.9rem;
}

.referrer-count, .browser-count, .os-count {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.85rem;
}

/* Search Section */
.search-section {
    max-width: 1400px;
    margin: 0 auto 40px;
}

.search-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.search-card {
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.search-card.search-card-alert {
    border-color: rgba(248, 113, 113, 0.3);
}

.search-card h3 {
    display: flex;
    align-items: center;
    gap: 10px;
    color: white;
    font-size: 1rem;
    margin: 0 0 20px;
}

.search-card h3 svg {
    stroke: #f87171;
}

.search-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 300px;
    overflow-y: auto;
}

.search-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
}

.search-item.search-item-alert {
    background: rgba(248, 113, 113, 0.1);
}

.search-keyword {
    color: #ffc168;
    font-weight: 500;
}

.search-stats {
    display: flex;
    gap: 15px;
}

.search-count {
    color: rgba(255, 255, 255, 0.7);
    font-size: 0.85rem;
}

.search-avg {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.8rem;
}

/* Tabs Section */
.tabs-section {
    max-width: 1400px;
    margin: 0 auto;
}

.tabs-header {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 25px;
    padding-bottom: 20px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
}

.tab-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 12px 20px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    color: rgba(255, 255, 255, 0.7);
    cursor: pointer;
    transition: all 0.3s;
    position: relative;
    font-size: 0.9rem;
}

.tab-btn svg {
    stroke: rgba(255, 255, 255, 0.5);
}

.tab-btn:hover {
    background: rgba(181, 96, 11, 0.2);
    border-color: rgba(181, 96, 11, 0.4);
}

.tab-btn.active {
    background: linear-gradient(135deg, #b5600b, #d1872c);
    border-color: #b5600b;
    color: white;
}

.tab-btn.active svg {
    stroke: white;
}

.tab-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    min-width: 20px;
    height: 20px;
    background: #f87171;
    border-radius: 10px;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
}

.tab-content {
    display: none;
    background: linear-gradient(135deg, rgba(40, 30, 20, 0.9), rgba(30, 20, 15, 0.95));
    border-radius: 16px;
    padding: 25px;
    border: 1px solid rgba(255, 255, 255, 0.08);
}

.tab-content.active {
    display: block;
}

.tab-header-bar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    flex-wrap: wrap;
    gap: 15px;
}

.tab-header-bar h3 {
    color: white;
    font-size: 1.1rem;
    margin: 0;
}

.tab-count {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.9rem;
}

/* User Category Badges */
.user-category-badges {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
}

.badge {
    padding: 5px 12px;
    border-radius: 15px;
    font-size: 0.8rem;
    font-weight: 500;
}

.badge-unverified { background: rgba(108, 117, 125, 0.3); color: #adb5bd; }
.badge-verified { background: rgba(40, 167, 69, 0.3); color: #4ade80; }
.badge-postman { background: rgba(181, 96, 11, 0.3); color: #ffc168; }
.badge-viewer { background: rgba(209, 135, 44, 0.3); color: #d1872c; }
.badge-staff { background: rgba(255, 193, 104, 0.3); color: #ffc168; }
.badge-success { background: rgba(40, 167, 69, 0.3); color: #4ade80; }
.badge-muted { background: rgba(108, 117, 125, 0.2); color: #6c757d; }

/* Tables */
.table-container {
    overflow-x: auto;
    margin-bottom: 20px;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
}

.admin-table th {
    text-align: left;
    padding: 12px 15px;
    background: rgba(181, 96, 11, 0.1);
    color: rgba(255, 255, 255, 0.9);
    font-weight: 600;
    font-size: 0.85rem;
    border-bottom: 1px solid rgba(181, 96, 11, 0.2);
}

.admin-table td {
    padding: 12px 15px;
    border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.9rem;
}

.admin-table tr:hover td {
    background: rgba(181, 96, 11, 0.05);
}

.user-cell {
    display: flex;
    align-items: center;
    gap: 10px;
}

.user-avatar {
    width: 35px;
    height: 35px;
    background: linear-gradient(135deg, #b5600b, #d1872c);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.9rem;
}

.category-select, .status-select {
    padding: 8px 12px;
    background: rgba(0, 0, 0, 0.3);
    border: 1px solid rgba(181, 96, 11, 0.3);
    border-radius: 6px;
    color: white;
    font-size: 0.85rem;
    cursor: pointer;
}

.category-select:focus, .status-select:focus {
    outline: none;
    border-color: #b5600b;
}

/* Buttons */
.btn-primary {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    background: linear-gradient(135deg, #b5600b, #d1872c);
    border: none;
    border-radius: 8px;
    color: white;
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.3s;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(181, 96, 11, 0.4);
}

.btn-icon {
    width: 35px;
    height: 35px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s;
    background: rgba(255, 255, 255, 0.1);
}

.btn-icon svg {
    stroke: white;
}

.btn-icon.btn-danger {
    background: rgba(248, 113, 113, 0.2);
}

.btn-icon.btn-danger svg {
    stroke: #f87171;
}

.btn-icon.btn-danger:hover {
    background: #f87171;
}

.btn-icon.btn-danger:hover svg {
    stroke: white;
}

/* Load prompt */
.load-prompt {
    text-align: center;
    padding: 40px;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
}

/* Postcards preview */
.postcards-preview {
    margin-bottom: 25px;
}

.postcards-preview h4 {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    margin-bottom: 15px;
}

.postcards-scroll {
    display: flex;
    gap: 15px;
    overflow-x: auto;
    padding-bottom: 10px;
}

.postcard-mini {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 15px 20px;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
    border: 1px solid rgba(255, 255, 255, 0.08);
    cursor: pointer;
    transition: all 0.3s;
    min-width: 120px;
}

.postcard-mini:hover {
    background: rgba(181, 96, 11, 0.2);
    border-color: #b5600b;
}

.postcard-rank {
    font-size: 0.75rem;
    color: #b5600b;
    font-weight: 600;
}

.postcard-number {
    color: white;
    font-size: 0.9rem;
    margin: 5px 0;
}

.postcard-views, .postcard-likes {
    font-size: 0.8rem;
    color: rgba(255, 255, 255, 0.6);
    display: flex;
    align-items: center;
    gap: 5px;
}

/* Rarity Stats */
.rarity-stats {
    margin-bottom: 25px;
}

.rarity-stats h4 {
    color: rgba(255, 255, 255, 0.8);
    font-size: 0.95rem;
    margin-bottom: 15px;
}

.rarity-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 15px;
}

.rarity-card {
    padding: 15px;
    border-radius: 10px;
    text-align: center;
}

.rarity-card.rarity-common {
    background: rgba(108, 117, 125, 0.2);
    border: 1px solid rgba(108, 117, 125, 0.3);
}

.rarity-card.rarity-rare {
    background: rgba(181, 96, 11, 0.2);
    border: 1px solid rgba(181, 96, 11, 0.3);
}

.rarity-card.rarity-very-rare {
    background: rgba(255, 215, 0, 0.15);
    border: 1px solid rgba(255, 215, 0, 0.3);
}

.rarity-label {
    display: block;
    font-weight: 600;
    margin-bottom: 10px;
    color: white;
}

.rarity-views, .rarity-likes {
    display: block;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
}

/* Rarity Badge */
.rarity-badge {
    padding: 4px 10px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 500;
}

.rarity-badge.rarity-common {
    background: rgba(108, 117, 125, 0.3);
    color: #adb5bd;
}

.rarity-badge.rarity-rare {
    background: rgba(181, 96, 11, 0.3);
    color: #ffc168;
}

.rarity-badge.rarity-very_rare {
    background: rgba(255, 215, 0, 0.3);
    color: #ffd700;
}

/* Suggestions List */
.suggestions-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.suggestion-item {
    padding: 20px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
    border-left: 4px solid transparent;
}

.suggestion-item.pending {
    border-left-color: #ffc107;
}

.suggestion-item.approved {
    border-left-color: #4ade80;
}

.suggestion-item.rejected {
    border-left-color: #f87171;
}

.suggestion-item.reviewed {
    border-left-color: #60a5fa;
}

.suggestion-header {
    display: flex;
    align-items: center;
    gap: 20px;
    flex-wrap: wrap;
    margin-bottom: 12px;
}

.suggestion-postcard, .suggestion-user {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
}

.suggestion-postcard {
    color: #b5600b;
}

.suggestion-user {
    color: rgba(255, 255, 255, 0.7);
}

.suggestion-date {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.85rem;
}

.suggestion-description {
    color: rgba(255, 255, 255, 0.9);
    margin: 0 0 15px;
    line-height: 1.6;
}

.suggestion-actions {
    display: flex;
    gap: 10px;
}

/* Messages List */
.messages-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
}

.message-item {
    padding: 20px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 12px;
}

.message-item.unread {
    border-left: 4px solid #4ade80;
    background: rgba(74, 222, 128, 0.05);
}

.message-header {
    display: flex;
    align-items: center;
    gap: 15px;
    flex-wrap: wrap;
    margin-bottom: 12px;
}

.message-user {
    display: flex;
    align-items: center;
    gap: 6px;
    color: rgba(255, 255, 255, 0.9);
    font-weight: 500;
}

.message-date {
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.85rem;
}

.new-badge {
    padding: 3px 10px;
    background: #4ade80;
    color: #1a1208;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.message-content {
    color: rgba(255, 255, 255, 0.9);
    margin: 0 0 12px;
    line-height: 1.6;
}

.message-footer {
    display: flex;
    gap: 15px;
}

.message-ip {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.8rem;
}

/* Likes List */
.likes-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 500px;
    overflow-y: auto;
}

.like-item {
    display: flex;
    align-items: center;
    gap: 15px;
    padding: 12px 15px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
}

.like-icon {
    width: 30px;
    display: flex;
    justify-content: center;
}

.like-postcard {
    color: #b5600b;
    font-weight: 500;
}

.like-user {
    color: rgba(255, 255, 255, 0.8);
    flex: 1;
}

.like-date {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.85rem;
}

/* IPs Tab */
.ips-section {
    margin-bottom: 30px;
}

.ips-section h4 {
    color: rgba(255, 255, 255, 0.8);
    font-size: 1rem;
    margin-bottom: 15px;
}

.ips-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
    max-height: 400px;
    overflow-y: auto;
}

.ip-item {
    display: flex;
    align-items: center;
    gap: 20px;
    padding: 15px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s;
    flex-wrap: wrap;
}

.ip-item:hover {
    background: rgba(181, 96, 11, 0.1);
}

.ip-item.suspicious {
    border-left: 3px solid #f87171;
}

.ip-main {
    flex: 1;
    min-width: 200px;
}

.ip-address {
    display: block;
    color: #b5600b;
    font-family: monospace;
    font-size: 0.95rem;
}

.ip-location {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
}

.ip-stats {
    display: flex;
    gap: 15px;
}

.ip-sessions, .ip-views {
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
}

.ip-sessions.warning {
    color: #f87171;
    font-weight: 600;
}

.ip-bot {
    padding: 2px 8px;
    background: rgba(248, 113, 113, 0.2);
    color: #f87171;
    border-radius: 10px;
    font-size: 0.75rem;
}

.ip-isp {
    color: rgba(255, 255, 255, 0.4);
    font-size: 0.8rem;
    min-width: 150px;
}

/* Modals */
.ip-modal, .postcard-modal {
    position: fixed;
    inset: 0;
    z-index: 5000;
    display: none;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.ip-modal.active, .postcard-modal.active {
    display: flex;
}

.modal-backdrop {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.9);
}

.modal-content {
    position: relative;
    background: linear-gradient(165deg, #252525, #1a1a1a);
    border-radius: 20px;
    padding: 30px;
    max-width: 600px;
    width: 100%;
    max-height: 90vh;
    overflow-y: auto;
    border: 1px solid rgba(181, 96, 11, 0.3);
}

.modal-content.modal-large {
    max-width: 800px;
}

.modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: rgba(255, 255, 255, 0.1);
    border: none;
    border-radius: 50%;
    padding: 8px;
    color: white;
    cursor: pointer;
    transition: all 0.3s;
}

.modal-close:hover {
    background: #b5600b;
}

.modal-content h2 {
    color: white;
    margin: 0 0 25px;
    font-size: 1.3rem;
}

/* IP Modal Content */
.ip-details {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.ip-detail-section h4 {
    color: #b5600b;
    margin: 0 0 12px;
    font-size: 0.95rem;
}

.ip-detail-section p {
    color: rgba(255, 255, 255, 0.8);
    margin: 8px 0;
    font-size: 0.9rem;
}

.ip-detail-section p strong {
    color: rgba(255, 255, 255, 0.5);
}

.ip-detail-section .warning {
    color: #f87171;
    font-weight: 500;
}

.sessions-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    max-height: 200px;
    overflow-y: auto;
}

.session-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 8px;
    font-size: 0.85rem;
    color: rgba(255, 255, 255, 0.7);
}

.session-user {
    color: #ffc168;
    font-weight: 500;
}

/* Postcard Analytics Modal */
.postcard-analytics {
    display: flex;
    flex-direction: column;
    gap: 25px;
}

.postcard-info-section {
    display: flex;
    gap: 20px;
    flex-wrap: wrap;
}

.postcard-preview {
    width: 200px;
    height: 150px;
    border-radius: 10px;
    overflow: hidden;
    background: rgba(0, 0, 0, 0.3);
}

.postcard-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.postcard-preview .no-image {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(255, 255, 255, 0.4);
}

.postcard-meta h3 {
    color: #b5600b;
    margin: 0 0 5px;
}

.postcard-meta p {
    color: rgba(255, 255, 255, 0.8);
    margin: 0 0 10px;
}

.animation-badge {
    display: inline-block;
    padding: 4px 10px;
    background: rgba(255, 193, 104, 0.2);
    color: #ffc168;
    border-radius: 12px;
    font-size: 0.75rem;
    margin-left: 8px;
}

.analytics-stats {
    display: flex;
    gap: 30px;
}

.analytics-stat {
    text-align: center;
}

.analytics-stat .stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: white;
}

.analytics-stat .stat-label {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.85rem;
}

.analytics-section h4 {
    color: rgba(255, 255, 255, 0.8);
    margin: 0 0 12px;
    font-size: 0.95rem;
}

.interactions-breakdown, .country-breakdown, .likes-breakdown {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.interaction-item, .country-item, .like-item-detail {
    display: flex;
    justify-content: space-between;
    padding: 8px 12px;
    background: rgba(255, 255, 255, 0.03);
    border-radius: 6px;
    font-size: 0.9rem;
    color: rgba(255, 255, 255, 0.8);
}

.animation-like {
    padding: 2px 8px;
    background: rgba(255, 193, 104, 0.2);
    color: #ffc168;
    border-radius: 10px;
    font-size: 0.75rem;
}

/* Loading Spinner */
.loading-spinner {
    width: 40px;
    height: 40px;
    border: 3px solid rgba(255, 255, 255, 0.1);
    border-top-color: #b5600b;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin: 40px auto;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* No Data */
.no-data {
    text-align: center;
    padding: 20px;
    color: rgba(255, 255, 255, 0.5);
    font-style: italic;
}

.no-data.success {
    color: #4ade80;
}

/* Error */
.error {
    text-align: center;
    padding: 20px;
    color: #f87171;
}

/* Table Info */
.table-info {
    text-align: center;
    color: rgba(255, 255, 255, 0.5);
    font-size: 0.85rem;
    margin-top: 15px;
}

/* Notifications */
.notification {
    position: fixed;
    top: 80px;
    right: 20px;
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 15px 25px;
    border-radius: 10px;
    color: white;
    z-index: 6000;
    animation: slideIn 0.3s ease;
}

.notification-success {
    background: linear-gradient(135deg, #22c55e, #16a34a);
}

.notification-error {
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

@keyframes slideIn {
    from { transform: translateX(100%); opacity: 0; }
    to { transform: translateX(0); opacity: 1; }
}

/* Responsive */
@media (max-width: 1200px) {
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .chart-card.chart-large {
        grid-column: 1;
    }
}

@media (max-width: 768px) {
    .dashboard-header {
        flex-direction: column;
        text-align: center;
    }
    
    .header-content {
        flex-direction: column;
    }
    
    .header-actions {
        justify-content: center;
    }
    
    .quick-stats-grid {
        grid-template-columns: 1fr;
    }
    
    .tabs-header {
        flex-direction: column;
    }
    
    .tab-btn {
        justify-content: center;
    }
    
    .traffic-card.traffic-card-large {
        grid-column: 1;
    }
    
    .realtime-stats {
        flex-direction: column;
        align-items: center;
    }
}
</style>
{% endblock %}