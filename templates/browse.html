<!-- templates/browse.html -->
{% extends 'base.html' %}
{% load static %}

{% block page_title %}Rechercher{% endblock %}

{% block content %}
<div class="browse-page">
    <!-- Search Section -->
    <div class="search-section">
        <form id="researchForm" class="search-form" method="get">
            <div class="search-box">
                <input type="text" name="keywords_input" id="keywords_input" 
                       value="{{ query|default:'' }}" 
                       placeholder="Rechercher dans la collection...">
                <button type="submit">
                    <img src="{% static 'images/Loupe_icone.png' %}" alt="Rechercher">
                </button>
            </div>
        </form>
        
        {% if query %}
        <p class="search-results-text">{{ total_count }} r√©sultat{{ total_count|pluralize }} pour "{{ query }}"</p>
        {% endif %}
    </div>

    <!-- Popups -->
    <div id="fade" class="overlay" onclick="closeAllPopups()"></div>
    
    <div id="popup_detail" class="popup">
        <button class="popup-close" onclick="closeAllPopups()">√ó</button>
        <img id="reverse_cp" class="popup-flip" src="{% static 'images/Verso.png' %}" onclick="togglePostcardSide();" title="Voir le verso">
        <img id="lat_arrow_0" class="popup-arrow popup-arrow-left" src="{% static 'images/fleche-laterale-1.png' %}" onclick="previousImage();">
        <img id="img_popup_detail" class="popup-image" src="" alt="">
        <img id="lat_arrow_1" class="popup-arrow popup-arrow-right" src="{% static 'images/fleche-laterale.png' %}" onclick="nextImage();">
        <div class="popup-info">
            <p id="p_cp_popup_detail" class="popup-title"></p>
            <p id="p_nb_cp_popup_detail" class="popup-number"></p>
        </div>
    </div>
    
    <div id="popup_zoom" class="popup popup-zoom">
        <button class="popup-close" onclick="closeAllPopups()">√ó</button>
        <img id="img_popup_zoom" class="popup-image-zoom" src="" alt="">
    </div>

    <!-- River Animation - Only without search -->
    {% if not query %}
    <div class="river-scene" id="river-scene">
        <!-- Gradient water background -->
        <div class="water-gradient"></div>
        
        <!-- Animated wave layers -->
        <div class="wave-container">
            <svg class="wave wave-1" viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill="rgba(181, 96, 11, 0.1)" d="M0,160L48,176C96,192,192,224,288,213.3C384,203,480,149,576,138.7C672,128,768,160,864,181.3C960,203,1056,213,1152,197.3C1248,181,1344,139,1392,117.3L1440,96L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
            <svg class="wave wave-2" viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill="rgba(209, 135, 44, 0.08)" d="M0,64L48,96C96,128,192,192,288,202.7C384,213,480,171,576,149.3C672,128,768,128,864,149.3C960,171,1056,213,1152,218.7C1248,224,1344,192,1392,176L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
            <svg class="wave wave-3" viewBox="0 0 1440 320" preserveAspectRatio="none">
                <path fill="rgba(255, 200, 100, 0.05)" d="M0,224L48,213.3C96,203,192,181,288,181.3C384,181,480,203,576,218.7C672,235,768,245,864,234.7C960,224,1056,192,1152,181.3C1248,171,1344,181,1392,186.7L1440,192L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path>
            </svg>
        </div>
        
        <!-- Light reflections -->
        <div class="light-reflections">
            <div class="light-reflection"></div>
            <div class="light-reflection"></div>
            <div class="light-reflection"></div>
            <div class="light-reflection"></div>
            <div class="light-reflection"></div>
        </div>
        
        <!-- Floating particles container -->
        <div class="particles-container" id="particles-container"></div>
        
        <!-- Floating words container -->
        <div class="words-container" id="words-container"></div>
        
        <!-- Instruction -->
        <div class="river-instruction">
            <p>‚ú® Cliquez sur un mot pour explorer la collection ‚ú®</p>
        </div>
    </div>
    {% endif %}

    <!-- Results Grid -->
    <div class="results-section">
        {% if postcards %}
        <div class="postcards-grid">
            {% for postcard in postcards %}
            <div class="postcard-card" data-id="{{ postcard.id }}">
                {% if postcard.vignette_url %}
                <img src="{{ postcard.vignette_url }}" 
                     alt="{{ postcard.title }}" 
                     loading="lazy" 
                     onerror="this.onerror=null; this.src='{% static 'images/placeholder.jpg' %}'; this.parentElement.classList.add('img-error');">
                {% else %}
                <div class="no-image-placeholder">
                    <span>üì∑</span>
                    <p>Image non disponible</p>
                </div>
                {% endif %}
                <div class="postcard-overlay">
                    <div class="postcard-actions">
                        <button onclick="showDetail({{ postcard.id }})" title="Voir">üëÅÔ∏è</button>
                        <button onclick="showZoom({{ postcard.id }})" title="Zoom">üîç</button>
                    </div>
                    <p class="postcard-title">{{ postcard.title|truncatechars:45 }}</p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        {% if query %}
        <div class="no-results">
            <p>Aucun r√©sultat pour "{{ query }}"</p>
            <a href="{% url 'browse' %}">‚Üê Voir toute la collection</a>
        </div>
        {% endif %}
        {% endif %}
    </div>
    
    <div class="browse-footer">
        <p>{{ total_count }} cartes postales dans la collection</p>
    </div>
</div>

<script>
// =============================================
// POSTCARD DATA AND NAVIGATION
// =============================================
const postcardsData = [
    {% for postcard in postcards %}
    {
        id: {{ postcard.id }},
        number: "{{ postcard.number|escapejs }}",
        title: "{{ postcard.title|escapejs }}",
        grande_url: "{{ postcard.grande_url|default:'' }}",
        dos_url: "{{ postcard.dos_url|default:'' }}",
        zoom_url: "{{ postcard.zoom_url|default:'' }}",
        vignette_url: "{{ postcard.vignette_url|default:'' }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
];

let currentIndex = 0;
let currentView = 'front';

// =============================================
// RIVER ANIMATION SYSTEM
// =============================================
const riverWords = [
    'Seine', 'Marne', 'Bateau', 'Pont', '√âcluse', 'P√©niche',
    'Navigation', 'Fleuve', 'Rivi√®re', 'Port', 'Quai', 'Berge',
    'Vapeur', 'Marinier', 'Halage', 'Remorqueur', 'Toueur',
    'Crue', 'Inondation', 'Paris', 'Bords', 'Eau', 'Canaux',
    'Passeur', 'Lavoir', 'Moulin', 'Barrage', 'Amont', 'Aval',
    {% for theme in themes %}'{{ theme.display_name|escapejs }}',{% endfor %}
];

class RiverAnimation {
    constructor() {
        this.particlesContainer = document.getElementById('particles-container');
        this.wordsContainer = document.getElementById('words-container');
        this.riverScene = document.getElementById('river-scene');
        
        if (!this.riverScene) return;
        
        this.particleCount = 40;
        this.wordSpawnInterval = 2500;
        this.maxActiveWords = 8;
        this.activeWords = 0;
        
        this.init();
    }
    
    init() {
        this.createParticles();
        this.startWordSpawner();
        this.addMouseInteraction();
    }
    
    createParticles() {
        for (let i = 0; i < this.particleCount; i++) {
            this.createParticle(i);
        }
    }
    
    createParticle(index) {
        const particle = document.createElement('div');
        particle.className = 'river-particle';
        
        // Random properties
        const size = 3 + Math.random() * 6;
        const duration = 12 + Math.random() * 18;
        const delay = (index / this.particleCount) * duration;
        const yPos = 10 + Math.random() * 80;
        const brightness = 0.5 + Math.random() * 0.5;
        
        particle.style.cssText = `
            width: ${size}px;
            height: ${size}px;
            top: ${yPos}%;
            right: -${size * 2}px;
            --duration: ${duration}s;
            --delay: ${delay}s;
            --brightness: ${brightness};
        `;
        
        this.particlesContainer.appendChild(particle);
    }
    
    startWordSpawner() {
        // Initial words with stagger
        for (let i = 0; i < 4; i++) {
            setTimeout(() => this.spawnWord(), i * 800);
        }
        
        // Continuous spawning
        setInterval(() => {
            if (this.activeWords < this.maxActiveWords) {
                this.spawnWord();
            }
        }, this.wordSpawnInterval);
    }
    
    spawnWord() {
        const word = document.createElement('button');
        word.className = 'floating-word';
        word.textContent = riverWords[Math.floor(Math.random() * riverWords.length)];
        
        // Random properties
        const yPos = 15 + Math.random() * 65;
        const duration = 16 + Math.random() * 10;
        const scale = 0.85 + Math.random() * 0.4;
        const delay = Math.random() * 1;
        
        word.style.cssText = `
            top: ${yPos}%;
            --duration: ${duration}s;
            --delay: ${delay}s;
            --scale: ${scale};
        `;
        
        // Click handler - IMPORTANT: Navigate to search
        word.onclick = (e) => {
            e.preventDefault();
            e.stopPropagation();
            this.searchWord(word.textContent);
        };
        
        this.wordsContainer.appendChild(word);
        this.activeWords++;
        
        // Remove after animation completes
        const totalTime = (duration + delay) * 1000;
        setTimeout(() => {
            if (word.parentNode) {
                word.remove();
                this.activeWords--;
            }
        }, totalTime);
    }
    
    searchWord(term) {
        // Visual feedback
        const searchInput = document.getElementById('keywords_input');
        if (searchInput) {
            searchInput.value = term;
            searchInput.classList.add('search-highlight');
            
            // Submit after brief animation
            setTimeout(() => {
                document.getElementById('researchForm').submit();
            }, 300);
        }
    }
    
    addMouseInteraction() {
        this.riverScene.addEventListener('mousemove', (e) => {
            const rect = this.riverScene.getBoundingClientRect();
            const x = (e.clientX - rect.left) / rect.width;
            const y = (e.clientY - rect.top) / rect.height;
            
            // Subtle parallax effect on waves
            const waves = this.riverScene.querySelectorAll('.wave');
            waves.forEach((wave, i) => {
                const offsetX = (x - 0.5) * (10 + i * 5);
                const offsetY = (y - 0.5) * (5 + i * 2);
                wave.style.transform = `translate(${offsetX}px, ${offsetY}px)`;
            });
        });
    }
}

// =============================================
// POSTCARD FUNCTIONS
// =============================================
function showDetail(id) {
    const p = postcardsData.find(x => x.id === id);
    if (!p) return;
    
    currentIndex = postcardsData.findIndex(x => x.id === id);
    currentView = 'front';
    
    const imgSrc = p.grande_url || p.vignette_url;
    if (!imgSrc) {
        alert('Image non disponible');
        return;
    }
    
    document.getElementById('img_popup_detail').src = imgSrc;
    document.getElementById('p_cp_popup_detail').textContent = p.title;
    document.getElementById('p_nb_cp_popup_detail').textContent = 'N¬∞ ' + p.number;
    
    document.getElementById('fade').style.display = 'block';
    document.getElementById('popup_detail').style.display = 'block';
    document.body.style.overflow = 'hidden';
    updateArrows();
}

function togglePostcardSide() {
    const p = postcardsData[currentIndex];
    const img = document.getElementById('img_popup_detail');
    
    if (currentView === 'front' && p.dos_url) {
        img.src = p.dos_url;
        currentView = 'back';
    } else {
        img.src = p.grande_url || p.vignette_url;
        currentView = 'front';
    }
}

function showZoom(id) {
    const p = postcardsData.find(x => x.id === id);
    if (!p) return;
    
    const zoomSrc = p.zoom_url || p.grande_url || p.vignette_url;
    if (!zoomSrc) {
        alert('Image non disponible');
        return;
    }
    
    document.getElementById('img_popup_zoom').src = zoomSrc;
    document.getElementById('fade').style.display = 'block';
    document.getElementById('popup_zoom').style.display = 'block';
    document.body.style.overflow = 'hidden';
}

function previousImage() {
    if (currentIndex > 0) {
        currentIndex--;
        updateDetail();
    }
}

function nextImage() {
    if (currentIndex < postcardsData.length - 1) {
        currentIndex++;
        updateDetail();
    }
}

function updateDetail() {
    const p = postcardsData[currentIndex];
    currentView = 'front';
    document.getElementById('img_popup_detail').src = p.grande_url || p.vignette_url;
    document.getElementById('p_cp_popup_detail').textContent = p.title;
    document.getElementById('p_nb_cp_popup_detail').textContent = 'N¬∞ ' + p.number;
    updateArrows();
}

function updateArrows() {
    document.getElementById('lat_arrow_0').style.display = currentIndex > 0 ? 'block' : 'none';
    document.getElementById('lat_arrow_1').style.display = currentIndex < postcardsData.length - 1 ? 'block' : 'none';
}

function closeAllPopups() {
    document.getElementById('fade').style.display = 'none';
    document.getElementById('popup_detail').style.display = 'none';
    document.getElementById('popup_zoom').style.display = 'none';
    document.body.style.overflow = '';
}

// Keyboard navigation
document.addEventListener('keydown', function(e) {
    if (document.getElementById('popup_detail').style.display === 'block') {
        if (e.key === 'ArrowLeft') previousImage();
        else if (e.key === 'ArrowRight') nextImage();
        else if (e.key === 'Escape') closeAllPopups();
    } else if (document.getElementById('popup_zoom').style.display === 'block') {
        if (e.key === 'Escape') closeAllPopups();
    }
});

// Initialize river animation on DOM ready
document.addEventListener('DOMContentLoaded', function() {
    new RiverAnimation();
});
</script>

<style>
/* ========================================
   BROWSE PAGE - BASE STYLES
   ======================================== */
.browse-page {
    min-height: 100vh;
    padding-top: 70px;
    background: linear-gradient(180deg, #1a1a1a 0%, #0d0d0d 100%);
}

/* ========================================
   SEARCH SECTION
   ======================================== */
.search-section {
    padding: 30px 20px;
    text-align: center;
}

.search-form {
    max-width: 600px;
    margin: 0 auto;
}

.search-box {
    display: flex;
    background: white;
    border-radius: 50px;
    overflow: hidden;
    box-shadow: 0 5px 30px rgba(0, 0, 0, 0.3);
    transition: box-shadow 0.3s, transform 0.3s;
}

.search-box:focus-within {
    box-shadow: 0 8px 40px rgba(181, 96, 11, 0.4);
    transform: translateY(-2px);
}

.search-box input {
    flex: 1;
    padding: 18px 25px;
    border: none;
    font-size: 1.1rem;
    outline: none;
    background: transparent;
}

.search-box input.search-highlight {
    animation: highlight-pulse 0.3s ease;
}

@keyframes highlight-pulse {
    0%, 100% { background: transparent; }
    50% { background: rgba(181, 96, 11, 0.2); }
}

.search-box button {
    padding: 15px 25px;
    background: linear-gradient(135deg, #b5600b, #d1872c);
    border: none;
    cursor: pointer;
    transition: transform 0.3s;
}

.search-box button:hover {
    transform: scale(1.05);
}

.search-box button img {
    height: 24px;
    filter: brightness(0) invert(1);
}

.search-results-text {
    color: #b5600b;
    margin-top: 20px;
    font-size: 1.1rem;
}

/* ========================================
   RIVER SCENE - ORANGE/YELLOW THEME
   ======================================== */
.river-scene {
    position: relative;
    height: 420px;
    margin: 20px;
    border-radius: 24px;
    overflow: hidden;
    background: linear-gradient(
        180deg,
        #1a1208 0%,
        #2d1f0d 25%,
        #3d2a12 50%,
        #2d1f0d 75%,
        #1a1208 100%
    );
    box-shadow: 
        inset 0 0 100px rgba(181, 96, 11, 0.1),
        0 10px 40px rgba(0, 0, 0, 0.4);
}

/* Water gradient overlay */
.water-gradient {
    position: absolute;
    inset: 0;
    background: 
        radial-gradient(ellipse at 30% 20%, rgba(255, 180, 50, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(181, 96, 11, 0.1) 0%, transparent 50%),
        radial-gradient(ellipse at 50% 50%, rgba(209, 135, 44, 0.05) 0%, transparent 70%);
    pointer-events: none;
}

/* Wave container */
.wave-container {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    overflow: hidden;
}

.wave {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 200%;
    height: 100%;
    transition: transform 0.3s ease-out;
}

.wave-1 {
    animation: wave-flow 25s linear infinite;
    opacity: 0.6;
}

.wave-2 {
    animation: wave-flow 20s linear infinite reverse;
    opacity: 0.4;
    bottom: 20px;
}

.wave-3 {
    animation: wave-flow 30s linear infinite;
    opacity: 0.3;
    bottom: 40px;
}

@keyframes wave-flow {
    from { transform: translateX(0); }
    to { transform: translateX(-50%); }
}

/* Light reflections */
.light-reflections {
    position: absolute;
    inset: 0;
    pointer-events: none;
}

.light-reflection {
    position: absolute;
    width: 200px;
    height: 100%;
    background: linear-gradient(
        180deg,
        rgba(255, 200, 100, 0.15) 0%,
        rgba(255, 180, 50, 0.08) 30%,
        rgba(181, 96, 11, 0.05) 60%,
        transparent 100%
    );
    animation: light-shimmer 6s ease-in-out infinite;
    filter: blur(20px);
}

.light-reflection:nth-child(1) { left: 5%; animation-delay: 0s; }
.light-reflection:nth-child(2) { left: 25%; animation-delay: 1.5s; width: 150px; }
.light-reflection:nth-child(3) { left: 45%; animation-delay: 3s; width: 250px; }
.light-reflection:nth-child(4) { left: 65%; animation-delay: 4.5s; width: 180px; }
.light-reflection:nth-child(5) { left: 85%; animation-delay: 2s; width: 120px; }

@keyframes light-shimmer {
    0%, 100% { 
        opacity: 0.3; 
        transform: scaleY(0.9) translateY(5%);
    }
    50% { 
        opacity: 0.8; 
        transform: scaleY(1.1) translateY(-5%);
    }
}

/* Particles container */
.particles-container {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
}

.river-particle {
    position: absolute;
    border-radius: 50%;
    background: radial-gradient(
        circle,
        rgba(255, 200, 100, calc(0.9 * var(--brightness, 1))) 0%,
        rgba(255, 160, 50, calc(0.6 * var(--brightness, 1))) 30%,
        rgba(181, 96, 11, calc(0.3 * var(--brightness, 1))) 60%,
        transparent 100%
    );
    box-shadow: 
        0 0 10px rgba(255, 180, 50, calc(0.6 * var(--brightness, 1))),
        0 0 20px rgba(181, 96, 11, calc(0.3 * var(--brightness, 1)));
    animation: particle-drift var(--duration) linear infinite;
    animation-delay: var(--delay);
}

@keyframes particle-drift {
    0% {
        transform: translateX(0) translateY(0) scale(0);
        opacity: 0;
    }
    5% {
        transform: translateX(-30px) translateY(-5px) scale(1);
        opacity: 0.9;
    }
    50% {
        transform: translateX(calc(-50vw - 50px)) translateY(10px) scale(1.2);
        opacity: 1;
    }
    95% {
        transform: translateX(calc(-100vw - 80px)) translateY(-8px) scale(0.8);
        opacity: 0.7;
    }
    100% {
        transform: translateX(calc(-100vw - 100px)) translateY(0) scale(0);
        opacity: 0;
    }
}

/* Words container */
.words-container {
    position: absolute;
    inset: 0;
    overflow: hidden;
}

.floating-word {
    position: absolute;
    right: -220px;
    padding: 10px 22px;
    font-family: 'Georgia', serif;
    font-style: italic;
    font-size: calc(1rem * var(--scale, 1));
    color: rgba(255, 240, 220, 0.9);
    background: linear-gradient(
        135deg,
        rgba(181, 96, 11, 0.25) 0%,
        rgba(139, 69, 19, 0.2) 100%
    );
    border: 1px solid rgba(255, 180, 100, 0.3);
    border-radius: 30px;
    cursor: pointer;
    white-space: nowrap;
    backdrop-filter: blur(4px);
    box-shadow: 
        0 4px 15px rgba(0, 0, 0, 0.3),
        inset 0 1px 0 rgba(255, 255, 255, 0.1);
    text-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);
    animation: 
        word-flow var(--duration) linear forwards,
        word-bob 4s ease-in-out infinite;
    animation-delay: var(--delay), 0s;
    transition: 
        transform 0.3s ease,
        background 0.3s ease,
        box-shadow 0.3s ease,
        border-color 0.3s ease;
    z-index: 10;
}

.floating-word:hover {
    background: linear-gradient(
        135deg,
        rgba(255, 160, 50, 0.9) 0%,
        rgba(181, 96, 11, 0.85) 100%
    ) !important;
    color: white !important;
    border-color: rgba(255, 200, 100, 0.8) !important;
    transform: scale(1.25) translateY(-5px) !important;
    box-shadow: 
        0 8px 30px rgba(255, 160, 50, 0.5),
        0 0 40px rgba(181, 96, 11, 0.4),
        inset 0 1px 0 rgba(255, 255, 255, 0.2) !important;
    animation-play-state: paused, paused !important;
    z-index: 100 !important;
}

.floating-word:active {
    transform: scale(1.15) !important;
}

@keyframes word-flow {
    0% {
        transform: translateX(0);
        opacity: 0;
    }
    3% {
        opacity: 1;
    }
    92% {
        opacity: 1;
    }
    100% {
        transform: translateX(calc(-100vw - 280px));
        opacity: 0;
    }
}

@keyframes word-bob {
    0%, 100% { 
        margin-top: 0;
        filter: brightness(1);
    }
    50% { 
        margin-top: -12px;
        filter: brightness(1.1);
    }
}

/* River instruction */
.river-instruction {
    position: absolute;
    bottom: 25px;
    width: 100%;
    text-align: center;
    pointer-events: none;
}

.river-instruction p {
    color: rgba(255, 200, 150, 0.5);
    font-style: italic;
    font-size: 0.95rem;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
}

/* ========================================
   RESULTS GRID
   ======================================== */
.results-section {
    padding: 30px 20px;
}

.postcards-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
    gap: 25px;
    max-width: 1400px;
    margin: 0 auto;
}

.postcard-card {
    position: relative;
    aspect-ratio: 3/2;
    border-radius: 16px;
    overflow: hidden;
    background: linear-gradient(135deg, #2a2a2a, #1a1a1a);
    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.4);
    cursor: pointer;
    transition: transform 0.4s ease, box-shadow 0.4s ease;
}

.postcard-card:hover {
    transform: translateY(-10px) scale(1.02);
    box-shadow: 
        0 20px 50px rgba(181, 96, 11, 0.3),
        0 0 30px rgba(255, 160, 50, 0.1);
}

.postcard-card img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.postcard-card:hover img {
    transform: scale(1.1);
}

.postcard-card.img-error {
    background: linear-gradient(135deg, #3a3a3a, #2a2a2a);
}

.no-image-placeholder {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: rgba(255, 255, 255, 0.3);
}

.no-image-placeholder span {
    font-size: 2.5rem;
    margin-bottom: 10px;
}

.no-image-placeholder p {
    font-size: 0.85rem;
}

.postcard-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    padding: 50px 15px 15px;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.95));
    opacity: 0;
    transform: translateY(10px);
    transition: opacity 0.3s, transform 0.3s;
}

.postcard-card:hover .postcard-overlay {
    opacity: 1;
    transform: translateY(0);
}

.postcard-actions {
    display: flex;
    justify-content: center;
    gap: 12px;
    margin-bottom: 12px;
}

.postcard-actions button {
    width: 44px;
    height: 44px;
    border: none;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.95);
    font-size: 1.2rem;
    cursor: pointer;
    transition: transform 0.2s, background 0.2s;
    box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
}

.postcard-actions button:hover {
    transform: scale(1.15);
    background: #b5600b;
}

.postcard-title {
    color: white;
    font-size: 0.9rem;
    text-align: center;
    margin: 0;
    line-height: 1.3;
}

.no-results {
    text-align: center;
    padding: 80px 20px;
    color: rgba(255, 255, 255, 0.7);
}

.no-results p {
    font-size: 1.3rem;
    margin-bottom: 20px;
}

.no-results a {
    color: #b5600b;
    text-decoration: none;
    font-size: 1.1rem;
    transition: color 0.3s;
}

.no-results a:hover {
    color: #d1872c;
}

.browse-footer {
    text-align: center;
    padding: 40px;
    color: rgba(255, 255, 255, 0.35);
    font-size: 0.95rem;
}

/* ========================================
   POPUPS
   ======================================== */
.overlay {
    display: none;
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.92);
    z-index: 2000;
    backdrop-filter: blur(8px);
}

.popup {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    z-index: 2001;
    max-width: 90vw;
    max-height: 90vh;
}

.popup-close {
    position: absolute;
    top: -18px;
    right: -18px;
    width: 44px;
    height: 44px;
    background: linear-gradient(135deg, #b5600b, #d1872c);
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 26px;
    cursor: pointer;
    z-index: 10;
    transition: transform 0.3s;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    line-height: 1;
}

.popup-close:hover {
    transform: scale(1.1) rotate(90deg);
}

.popup-image {
    max-width: 80vw;
    max-height: 70vh;
    border-radius: 12px;
    box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
}

.popup-flip {
    position: absolute;
    top: 12px;
    left: 12px;
    width: 40px;
    height: 40px;
    cursor: pointer;
    background: rgba(0, 0, 0, 0.6);
    border-radius: 50%;
    padding: 8px;
    z-index: 5;
    transition: transform 0.3s, background 0.3s;
}

.popup-flip:hover {
    transform: scale(1.1);
    background: #b5600b;
}

.popup-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    height: 55px;
    cursor: pointer;
    opacity: 0.6;
    z-index: 5;
    transition: opacity 0.3s, transform 0.3s;
    filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.5));
}

.popup-arrow:hover {
    opacity: 1;
    transform: translateY(-50%) scale(1.15);
}

.popup-arrow-left { left: -70px; }
.popup-arrow-right { right: -70px; }

.popup-info {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(135deg, #b5600b, #d1872c);
    padding: 18px 25px;
    border-radius: 0 0 12px 12px;
}

.popup-title {
    color: white;
    margin: 0 0 6px 0;
    font-size: 1.05rem;
    line-height: 1.3;
}

.popup-number {
    color: rgba(255, 255, 255, 0.75);
    margin: 0;
    font-size: 0.9rem;
}

.popup-zoom .popup-image-zoom {
    max-width: 95vw;
    max-height: 95vh;
    cursor: zoom-in;
    border-radius: 8px;
}

/* ========================================
   RESPONSIVE
   ======================================== */
@media (max-width: 900px) {
    .river-scene {
        height: 350px;
        margin: 15px;
    }
    
    .postcards-grid {
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 15px;
    }
}

@media (max-width: 600px) {
    .river-scene {
        height: 300px;
        margin: 10px;
        border-radius: 16px;
    }
    
    .floating-word {
        padding: 8px 16px;
        font-size: calc(0.85rem * var(--scale, 1));
    }
    
    .postcards-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
    }
    
    .popup-arrow-left { left: 10px; }
    .popup-arrow-right { right: 10px; }
    .popup-arrow { height: 40px; }
    
    .search-box input {
        padding: 14px 18px;
        font-size: 1rem;
    }
}

@media (max-width: 400px) {
    .postcards-grid {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %}